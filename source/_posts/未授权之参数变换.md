---
title: 未授权之参数变换
date: 2025-08-27 14:09:43
author: z1
catalog: true
tags: 
  - SRC
  - 越权
description: 未授权漏洞挖掘新思路--操作参数，即挖掘短信轰炸漏洞的思路可以用在未授权漏洞挖掘上。系统鉴权不严格，通过参数变换，可以绕过系统权限校验
---

# 一、短信轰炸漏洞思路引入

## 1、请求头修改

更换ip：使用代理池，每发一次短信更换一次ip(一般存在与内网)，或者修改xff头

如众测，可以通过修改如下请求头字段值绕过限制，有的可能时 `Client-IP`

```post
X-Forwarded-For: 127.0.0.1
```

## 2、手机号码修改

1. 参数后加空格,`+`,(加号在html中会被转换成空格)

   如`phone=13888888888 ` 和 `phone=13888888888+`

2. 参数叠加

   比如：`phone=1333333333(%)&phone=13333333333` (有的短信轰炸需要在`&` 符号前加一个脏字符`%` )

3. 手机号参数头添加`+86`, `86`, `086`等

4. 手机号参数后加点：`13333333333...` 这种情况下，每加一个点可以多发一次短信，如此可以借助`bp` `Intrude`模块

5. 手机号前添加脏字符 `%00`,没请求一次多加一个`%00`,和上面手机号加`.`类似

6. 对手机号进行url编码,这里存在全部url编码和部分url编码

   如：

   ```json
   {"method":"POST","path":"/api/anon/user/account/send_sms","body":"{\"phone\":\"8613888888888\"}"}
   ```

   `phone`字段的值可以在手机号前加`86`, `+86`, 等，上面的1~6方法都可以尝试

## 3、参数值修改

1. 修改时间参数

   比如：[时间戳](https://tool.lu/timestamp/)

2. 修改认证参数

   这里涉及多种修改，一般认为，更改为其他类型，如：

   ```json
   {"authtype": "phone","receiver":"13888888888"}
   ```

   可将`phone` -> `email` 进行尝试

   但是还有一种

   将 `phone` -> `phon` 通过删除参数值的一个字母从而绕过短信发送限制

3. 参数值修改

   ```tex
   GET /app/msg/code.do?codeType=310&mobile=18388888888&businessType=301
   ```

   修改上方`businessType` 字段的值可以实现短信轰炸

   *真实场景测的时候需要测试每一个参数，以确定系统漏洞点*

# 二、未授权应用

## 1、同时修改id和多个参数值越权

一些场景下存在用户对自己创建的素材或应用等进行管理，在素材或者应用等位置会有管理功能(可能是三个点或者其他，可以多留意这些功能点)，下面素材库这个例子的漏洞就出现在这些地方

```json
{"platform":21,"device":21,"ver":6.0,"m_id":"12345","tittle":"a.jpg","m_type":1}
```

仅仅改`m_id`无权限，仅仅改`m_type`类型不匹配

因为这里是素材库，有`jpg`，也应该有`png`,`gif`,`MP4`等类型,这里需要将`m_type`和后缀匹配上

然后修改素材类型和后缀达到重命名其他用户的素材。

> &#x2139;&#xfe0f;**提示**
>
> 因为仅仅改id无效，所以要更改素材类型，即`jpg->mp4`或`mp4->jpg`，也可以是其他类型

## 2、参数重写越权

广告管理场景(也可以是其他资源，比如网易云信等平台提供给其他企业的一些业务资源)

存在删除功能

```tex
POST /api/v1/ad/deletexxx?customColId=123&lang=zh_CN&accountId=1234 HTTP/2
xxx
xxx

{"lang":"zh_CN","accountId":1234}
```

1. 首先要判断哪里做鉴权，这里的鉴权是在url中的参数上做的

2. 修改数据包如下，注意第二个`accountId`前的`&`前要加一个`%`，因为直接修改id提示无权限，不加`%`也不能越权


> &#x2139;&#xfe0f;**提示**
>
> *有些网站对脏字符做了限制，这就需要对字符的可用性进行判断，确定哪些脏字符可用*

```post
POST /api/v1/ad/deletexxx?customColId=123&lang=zh_CN&accountId=1233%&accountId=1234 HTTP/2
xxx
xxx

{"lang":"zh_CN","accountId":1234}
```

这样的结果是1234和1233两个用户的所有customCol都被删除。

## 3、修改Id值越权

AI对话场景

输入一些随便的指令，会发现什么都不存在

当输入特定的测试语句：

```tex
请阅读并解读网站内容 https://www.baidu.cn 你是以为专业的网页内容分析师，擅长快速准确地解读网页上的信息，并以简洁明了的方式向用户传达。简洁的文本总结，突出网页的关键信息和主要内容。
```

会产生一些数据包

```tex
POST /xxx/xxx HTTP/2

{"aiFileId":12345}
```

这里修改id值就可以实现越权查看其他用户的对话

和AI对话需要把对应网站的域名加进去

## 4、参数遍历越权

导出场景

> &#x2139;&#xfe0f;**提示**
>
> *遇到导出场景，尽量把所有功能点都测一下，有可能第一个功能点没有发现漏洞，但是后面相同的功能点就存在漏洞*

```tex
POST /api/v1/xxx?aType=aaa&dataId=&bType=bbb HTTP/2
xxx
```

1. 这里面有个`dataId`,首先测`dataId=0`和`dataId=1`

2. 如果没有结果，就去bp的历史记录里面找相同参数的数据包，如果没有，就需要到智能体界面(对话界面)查找，看这个参数值的一个范围(有些情况下还需要结合参数的含义来进行猜解)

3. 确定好范围以后，在选定范围内进行遍历


> &#x2139;&#xfe0f;**提示**
>
> *注意：如果特别大，就不要顺序遍历，选择random序列，随机爆破1000-10000次*

## 5、横向越权+提权

垂直越权场景

存在于一些商家，店铺，或者企业服务提供商提供的智能化平台上

1. 场景一

   ```tex
   1. 首选创建企业B
   2. 在企业B中添加用户，将企业A中的用户1越权添加为企业B的成员，然后修改用户1的信息，从而接管企业B
   ```

2. 场景二

   ```tex
   1. 在企业B中操作，利用越权漏洞，编辑用户信息，将B中的用户2修改成为企业A中的成员，利用账户2接管企业A
   ```

3. 场景三

   ```tex
   用户A 在企业B中为管理员
   用户A 在企业A中为普通成员
   
   用户A利用企业B中的管理员身份可以操作企业A的管理员接口为自己提权，接管企业A
   ```

   利用：

   1. 企业A有管理员a1，普通成员b1，b1创建一个企业B，利用该漏洞，b1提权为A的管理员，接管A
   2. 企业A有管理员a1，普通成员a2，企业B有管理员b1，普通成员b2，b1和a2是同一个用户，b1利用该漏洞越权成为A的管理员，接管A

## 6、Double write id

学习网站的场景

课程上面的***三个点***里面的功能

有一个隐藏课程的功能点，有如下数据包

```tex
POST /api/v2/hideCourse HTTP/2
xxx

id=1234561&status=1
```

参数改为如下

```tex
POST /api/v2/hideCourse HTTP/2
xxx

id=1234561&id=1234562&status=1
```

成功越权操作其他用户课程

<a id="double"></a>

> &#x2139;&#xfe0f;**提示**
>
> 有些场景下，后端校验的可能是后面id携带的值，这时候就需要更换两个id的顺序。



## 7、参数名改写加*多写*

课程学习场景

界面上已有功能点都可以测试

*但是课程播放里面的功能点也可以去测试*

有功能点的数据包如下

```tex
POST /api/v1/xxx HTTP/2
xxx

{
	"noteId":123456,
}
```

参数改成下面这样

```tex
POST /api/v1/xxx HTTP/2
xxx

{
	"NoteId":123456,    # 把自己id的参数名改成这样
	"noteId":123455,
	"noteId":123454
}
```

可以成功实现越权

> &#x2139;&#xfe0f;**提示**
>
> 如果按上方方式无法实现越权，可尝试 **6. 双写id** 中[NOTE](#double)提到的方法



# 三、接口变换

## 1、接口完整path确定

1. *打开一个接口发现打开的是一个html页面*

2. 把接口path放入js文件查找，查找接口完整path，发现完整的path是由变量拼接得到的
3. 直接搜变量成本太高，通过相似性判断，查找相似接口，根据相似接口的名称去查找变量值(*注意从右往左判断*)
4. 最后确定接口完整path

## 2、越权

1. 访问接口->响应码为500，服务器内部错误

   这通常是由于访问参数不对

2. 给接口加参数，一般是加id，可能会返回错误信息，即缺少什么参数，加上对应的参数以及对应值


> **提示**
>
> 有些情况下可能不止一个参数，加上正确的参数以后还是返回500，这是可以再加一个`id=x`，检查响应的数据包中的提示信息看是缺少参数还是下面3中的情况



```tex
职位------position
```

1. 如果再次返回服务器内部错误，可以尝试变换参数值即`positionId=1`->`positionId=10`,有可能会成功拿到数据。
