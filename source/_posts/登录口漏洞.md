---
layout:     post   				    # 使用的布局（不需要改）
title:      登录口漏洞 				    # 标题
categories: SRC                        # 分类
date:       2024-11-08 				# 时间
author:     z1 						# 作者
catalog: true 						# 是否归档
tags:								# 标签
    - src
description: 登录口漏洞挖掘方法
---
# 登录口漏洞

## 场景

1. 登录

   任意用户登录，弱口令，万能密码，session模拟登录，Js审查（代码中存在密码泄露）

2. 注册

   如果没有提供注册功能，可以尝试手动构造注册接口

   任意用户注册（注册已存在账户造成账号接管）

3. 密码重置

   任意用户密码重置，默认密码，session覆盖

4. 验证码

   短信，图片，邮箱三类验证码

## 任意用户登录

- 常见

  - 手机号和验证码未绑定：用自己手机号接收验证码，登录时改成其他手机号
  - 一值传多参：加逗号，一个值带多个参数
  - 多值混淆：mobile=153xxxx&mobile=134xxxxx

- 第三方

  - 第三方软件登录：微博/微信/qq -- wxid：xxxx(根据wxid识别账户), 不可遍历id, 通过查找泄露登录其他用户账号

  - 第三方软件登录：微博/微信/qq -- userid：xxxx(根据userid识别账户), 可遍历id通过篡改id值, 登录其他用户账号

  - 登录状态下点击授权：点击后携带参数, 如用户id,这时候可以修改id值, 实现任意用户登录

    > &#x2139;&#xfe0f;**提示**
    >
    > 这种漏洞多出现在主域名相同而子域名不同的两个站之间

  *对这些登录过程进行抓包*

- 其他

  登录无二次验证

## 任意用户注册

### 分类

- 可覆盖注册：可注册已注册用户
  - 数据重置
  - 接管数据--危害最大
- 不可覆盖注册：只能注册未注册用户

这里任意用户注册主要针对邮箱注册。开始挖洞时先把注册的业务流程完整走一遍。

1. 邮箱发送激活链接注册

   - 信息填写完成后的返回包泄露 active code 或 激活id

   - 信息填写完成后跳转等待激活页面存在泄露active code 或 激活id

2. 尝试注册高权限账号（利用企业域名注册企业邮箱等）

   注册的账号权限越高，越好挖。（*方便以后挖洞*）

   - xxxx@企业域名

   - whois查询手机号邮箱

## 密码重置

- 不验证原密码&原密码可绕过

- csrf 提高危害，构造链接让受害者访问达到用户密码重置。

## 验证码

### 短信验证码

- 短信轰炸

  ```tex
  %09
  %0a
  %0c
  %0d
  %0b
  %a0
  +86
  ```

  *+86 如果在界面中没有显示，但是抓包时有可以修改从而绕过*

- 验证码复用：填正确的验证码发送到repeater模块一直重放，若是不提示验证码错误而一直提示账密错误则存在验证码复用即验证码不过期

- 验证码爆破：4，6位都可作为漏洞提交，只要公告中没有明确说明不收

  6位的话，先接收一个，然后在这一个验证码上下1000个以内利用bp爆破

- 报错回显：填写错误的，响应数据包中存在正确的验证码

- 绑定关系失效

  - 手机号与验证码未绑定
  - 双写绕过
    - 手机号参数写两个手机号，用 `,` 或 `空格` 或 `|` 隔开
    - 传入两个手机号参数

- 修改参数

  - 状态码
  - 鉴权相应参数
  - `false` 改 `true` 

- 删除验证码字段

- 统一初始化：测试 `0000` `none` `true` `1111` `null` 置空

- 任意验证码，后端没有校验验证码，只需要填对位数

### 验证码缺陷

1. 验证码校验和账密校验分两步，这种情况下可以尝试抓取账密校验的数据包，直接绕过验证码校验。这种情况属于后端设计缺陷。

2. 删除验证码键值对，绕过验证码校验

   > 后端设计登录逻辑时，留下了开发环境的登录接口，导致不输入验证码时调用的是开发环境的接口，即无需验证码登录的接口。

### 图形验证码

1. 图形验证码DDos：请求验证码的数据包中如果存在图片的大小，则可以通过修改长宽对应的值，造成返回数据包过大，使服务器宕机。

   > &#x2139;&#xfe0f;**提示**
   >
   > 一般不要设置太大，防止把服务器搞崩。
   >
   > 测试的时候只需要修改值，看返回数据包的大小是否变化，如果变了就可以交洞了。

   **图形验证码DDos fuzz**

   ```tex
   height=250
   width=250
   h=250
   w=250
   size=250
   margin=250
   font_size=250
   length=250
   height=250*2
   width=250*2
   h=250*2
   w=250*2
   size=250*2
   margin=250*2
   font_size=250*2
   length=250*2
   height=250&width=250&h=250&w=250&size=250&margin=250&font_size=250&length=250
   imageVerifyCodeWidth=250&imageVerifyCodeHeight=250
   imageVerifyCodeHeight=250
   ```

   
